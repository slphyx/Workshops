(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     99405,       2092]
NotebookOptionsPosition[     98999,       2075]
NotebookOutlinePosition[     99423,       2091]
CellTagsIndexPosition[     99380,       2088]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Column", "[", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ParaDist", "[", 
        RowBox[{"initN", ",", "48", ",", "\[Mu]", ",", "\[Sigma]"}], "]"}], 
       ","}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"DHAGraph", "[", 
        RowBox[{"xm", ",", "ym", ",", "a", ",", "ke"}], "]"}], ","}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ParaGraph", "[", 
      RowBox[{
      "initN", ",", "PMR", ",", "\[Mu]", ",", "\[Sigma]", ",", "48", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"KZRB", ",", "KZRE"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"KZRE", "+", "1"}], ",", "KZTE"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"KZTE", "+", "1"}], ",", "KZSE"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xm", ",", "ym", ",", "a", ",", "ke"}], "}"}], ",", "everyH", 
       ",", "Ndrug", ",", 
       RowBox[{"{", 
        RowBox[{"\[Gamma]R", ",", "\[Gamma]T", ",", "\[Gamma]S"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ec50R", ",", "ec50T", ",", "ec50S"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.0", ",", "0.0", ",", "0.0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"emaxR", ",", "emaxT", ",", "emaxS"}], "}"}], ",", "T", ",", 
       "120", ",", "dataset"}], "]"}], "\[IndentingNewLine]", "}"}], "]"}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<Mahidol-Oxford Tropical Medicine Research Unit\>\"", ",", "Bold"}], 
    "]"}], ",", "Delimiter", ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ctrl", ",", "1", ",", "\"\<\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "\[Rule]", "\"\<parasite distribution\>\""}], ",", 
       RowBox[{"2", "\[Rule]", "\"\<dose regimen\>\""}], ",", 
       RowBox[{"3", "\[Rule]", "\"\<DHA concentration\>\""}], ",", 
       RowBox[{"4", "\[Rule]", "\"\<kill zones\>\""}], ",", 
       RowBox[{"5", "\[Rule]", "\"\<killing effect\>\""}], ",", 
       RowBox[{"6", "\[Rule]", "\"\<Data set\>\""}]}], "}"}], ",", 
     RowBox[{"ControlPlacement", "\[Rule]", "Top"}]}], "}"}], ",", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"PaneSelector", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"1", "\[Rule]", " ", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<Parasite distribution on admission\>\"", ",", "Bold"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           "\"\<initial number of parasites\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"initN", ",", 
                RowBox[{"2.8", "*", 
                 RowBox[{"10", "^", "11"}]}], ",", "\"\<\>\""}], "}"}], ",", 
              RowBox[{"1.", "*", 
               RowBox[{"10", "^", "11"}]}], ",", 
              RowBox[{"10", "^", "12"}], ",", 
              RowBox[{"0.5", "*", 
               RowBox[{"10", "^", "11"}]}], ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           "\"\<parasite multiplication rate (/48 hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"PMR", ",", "7", ",", "\"\<\>\""}], "}"}], ",", "6", 
              ",", "32", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<mean age of parasite (hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Mu]", ",", "10", ",", "\"\<\>\""}], "}"}], ",", "1",
               ",", "48", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           "\"\<standard deviation of parasite ages (hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Sigma]", ",", "4", ",", "\"\<\>\""}], "}"}], ",", 
              "1", ",", "50", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}]}], "}"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"2", "\[Rule]", " ", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"\"\<Dose regimen\>\"", ",", "Bold"}], "]"}], ",", 
           "\[IndentingNewLine]", "\"\<number of doses\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Ndrug", ",", "7", ",", "\"\<\>\""}], "}"}], ",", "1", 
              ",", "24", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<dosing interval (hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"everyH", ",", "24", ",", "\"\<\>\""}], "}"}], ",", 
              "1", ",", "48", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}]}], "}"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"3", "\[Rule]", " ", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
            "\"\<DHA concentration profile (for each dose)\>\"", ",", 
             "Bold"}], "]"}], ",", "\[IndentingNewLine]", 
           "\"\<time at max concentration (hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"xm", ",", "2", ",", "\"\<\>\""}], "}"}], ",", "1", 
              ",", "20", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<max concentration (ng/ml)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ym", ",", "1000", ",", "\"\<\>\""}], "}"}], ",", 
              "0.5", ",", "2000.", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<elimination rate (/hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ke", ",", "0.5", ",", "\"\<\>\""}], "}"}], ",", 
              "0.001", ",", "10", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}]}], "}"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"4", "\[Rule]", " ", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"\"\<Kill zones (sensitive ages) \>\"", ",", "Bold"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           "\"\<ring: begin kill zone (hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"KZRB", ",", "6", ",", "\"\<\>\""}], "}"}], ",", "1", 
              ",", "96", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<ring: end kill zone (hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"KZRE", ",", "26", ",", "\"\<\>\""}], "}"}], ",", 
              "KZRB", ",", "60", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           "\"\<trophozoite: end kill zone (hours)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"KZTE", ",", "38", ",", "\"\<\>\""}], "}"}], ",", 
              RowBox[{"KZRE", "+", "1"}], ",", "90", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<schizont: end kill zone (hours)\>\"", 
           ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"KZSE", ",", "44", ",", "\"\<\>\""}], "}"}], ",", 
              RowBox[{"KZTE", "+", "1"}], ",", "100", ",", "1", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}]}], "}"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"5", "\[Rule]", " ", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"\"\<Killing effect parameters\>\"", ",", "Bold"}], "]"}],
            ",", "\[IndentingNewLine]", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Gamma]R", ",", "6.5"}], "}"}], ",", "0.5", ",", 
              "10", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Gamma]T", ",", "6.5"}], "}"}], ",", "0.5", ",", 
              "10", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Gamma]S", ",", "6.5"}], "}"}], ",", "0.5", ",", 
              "10", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<EC50 ring (ng/ml)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ec50R", ",", "20.5", ",", "\"\<\>\""}], "}"}], ",", 
              "0.001", ",", "100", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<EC50 trophozoites (ng/ml)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ec50T", ",", "20.5", ",", "\"\<\>\""}], "}"}], ",", 
              "0.001", ",", "100", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<EC50 schizont (ng/ml)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ec50S", ",", "20.5", ",", "\"\<\>\""}], "}"}], ",", 
              "0.001", ",", "100", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<ring: max efficacy (%)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"emaxR", ",", "99.99", ",", "\"\<\>\""}], "}"}], ",", 
              "50", ",", "99.999", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<trophozoite: max efficacy (%)\>\"", 
           ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"emaxT", ",", "99.99", ",", "\"\<\>\""}], "}"}], ",", 
              "50", ",", "99.999", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<schizont: max efficacy (%)\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"emaxS", ",", "99.99", ",", "\"\<\>\""}], "}"}], ",", 
              "50", ",", "99.999", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "\"\<1/alpha\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"T", ",", "5.", ",", "\"\<\>\""}], "}"}], ",", "1.", 
              ",", "10.", ",", "0.001", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Tiny"}]}], "}"}]}]}], "}"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"6", "\[Rule]", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"\"\<Data set\>\"", ",", "Bold"}], "]"}], ",", 
           "\[IndentingNewLine]", "\"\<Show observed data\>\"", ",", 
           RowBox[{"Control", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"dataset", ",", "0", ",", "\"\<\>\""}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "\[Rule]", "\"\<No\>\""}], ",", 
                RowBox[{"1", "\[Rule]", "\"\<Wang Pha (M21)\>\""}], ",", 
                RowBox[{"2", "\[Rule]", "\"\<Pailin (P33)\>\""}]}], "}"}], 
              ",", 
              RowBox[{"ControlType", "\[Rule]", "RadioButton"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "}"}], "]"}]}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Dynamic", "[", "ctrl", "]"}]}], "\[IndentingNewLine]", "]"}], 
   ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"ControlPlacement", "\[Rule]", "Left"}], ",", 
   RowBox[{"SynchronousInitialization", "\[Rule]", "False"}], ",", 
   RowBox[{"ContinuousAction", "\[Rule]", "False"}], ",", 
   RowBox[{"AutorunSequencing", "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2"}], "}"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"Initialization", "\[RuleDelayed]", 
    RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"concentration", " ", "of", " ", "DHA"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"genpoints", "[", 
        RowBox[{"xm_", ",", "ym_", ",", "ke_", ",", "x_"}], "]"}], ":=", 
       RowBox[{"Piecewise", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ym", "-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"ym", "/", "xm"}], ")"}], "*", 
              RowBox[{"(", 
               RowBox[{"xm", "-", "x"}], ")"}]}]}], ",", 
            RowBox[{"x", "\[LessEqual]", " ", "xm"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ym", "*", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "ke"}], "*", 
               RowBox[{"(", 
                RowBox[{"x", "-", "xm"}], ")"}]}], "]"}]}], ",", 
            RowBox[{"x", ">", " ", "xm"}]}], "}"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "calculate", " ", "the", " ", "drug", " ", "concentration", " ", "and",
         " ", "drug", " ", "efficacy", " ", "of", " ", "each", " ", 
        "parasite", " ", "stage", 
        RowBox[{"(", 
         RowBox[{"Ring", ",", 
          RowBox[{"Trophozoite", " ", "and", " ", "Schizont"}]}], ")"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ConcMod", "[", 
        RowBox[{
        "xm_", ",", "ym_", ",", "a_", ",", "ke_", ",", "everyH_Integer", ",", 
         "Ndrug_Integer", ",", "gamma_List", ",", "ec50_List", ",", 
         "emin_List", ",", "emax_List"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"j", "=", "0"}], ",", 
           RowBox[{"nd", "=", "1"}], ",", "dat", ",", "maxpoint", ",", 
           "part1", ",", "part2", ",", "fitke", ",", "modka", ",", "modke", 
           ",", "fn", ",", "x", ",", "endtime", ",", "t", ",", 
           RowBox[{"conc", "=", "0"}], ",", 
           RowBox[{"concls", "=", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"TIMEMAX", "=", "1000"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "0"}], ",", 
            RowBox[{"i", "<", 
             RowBox[{"Ndrug", "*", "everyH"}]}], ",", 
            RowBox[{"i", "=", 
             RowBox[{"i", "+", "1"}]}], ",", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"j", "\[NotEqual]", "everyH"}], ",", 
               RowBox[{
                RowBox[{"conc", "=", 
                 RowBox[{
                  RowBox[{"genpoints", "[", 
                   RowBox[{"xm", ",", "ym", ",", "ke", ",", "x"}], "]"}], "/.", 
                  RowBox[{"x", "\[Rule]", "j"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"concls", ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "conc", ",", 
                    RowBox[{"Eff", "[", 
                    RowBox[{"conc", ",", 
                    RowBox[{"gamma", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"ec50", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"emin", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"emax", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"Eff", "[", 
                    RowBox[{"conc", ",", 
                    RowBox[{"gamma", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"ec50", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"emin", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"emax", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"Eff", "[", 
                    RowBox[{"conc", ",", 
                    RowBox[{"gamma", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"ec50", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"emin", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"emax", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "}"}]}], "]"}],
                 ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"j", "\[Equal]", "everyH"}], "&&", 
                RowBox[{"nd", "<", "Ndrug"}]}], ",", 
               RowBox[{
                RowBox[{"nd", "=", 
                 RowBox[{"nd", "+", "1"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"conc", "=", 
                 RowBox[{
                  RowBox[{"conc", "+", 
                   RowBox[{"genpoints", "[", 
                    RowBox[{"xm", ",", "ym", ",", "ke", ",", "x"}], "]"}]}], "/.", 
                  RowBox[{"x", "\[Rule]", "j"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"concls", ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "conc", ",", 
                    RowBox[{"Eff", "[", 
                    RowBox[{"conc", ",", 
                    RowBox[{"gamma", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"ec50", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"emin", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"emax", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"Eff", "[", 
                    RowBox[{"conc", ",", 
                    RowBox[{"gamma", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"ec50", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"emin", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"emax", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"Eff", "[", 
                    RowBox[{"conc", ",", 
                    RowBox[{"gamma", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"ec50", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"emin", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"emax", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "}"}]}], "]"}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"j", "=", "0"}], ";"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"update", " ", "ndrug"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"j", "=", 
              RowBox[{"j", "+", "1"}]}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"i", "=", 
              RowBox[{"Ndrug", "*", "everyH"}]}], ";", 
             RowBox[{"j", "=", "everyH"}]}], ",", 
            RowBox[{"i", "\[LessEqual]", "TIMEMAX"}], ",", 
            RowBox[{"i", "=", 
             RowBox[{"i", "+", "1"}]}], ",", 
            RowBox[{
             RowBox[{"conc", "=", 
              RowBox[{
               RowBox[{"genpoints", "[", 
                RowBox[{"xm", ",", "ym", ",", "ke", ",", "x"}], "]"}], "/.", 
               RowBox[{"x", "\[Rule]", "j"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"concls", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "conc", ",", 
                 RowBox[{"Eff", "[", 
                  RowBox[{"conc", ",", 
                   RowBox[{"gamma", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"ec50", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"emin", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"emax", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"Eff", "[", 
                  RowBox[{"conc", ",", 
                   RowBox[{"gamma", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                   RowBox[{"ec50", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                   RowBox[{"emin", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                   RowBox[{"emax", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"Eff", "[", 
                  RowBox[{"conc", ",", 
                   RowBox[{"gamma", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                   RowBox[{"ec50", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                   RowBox[{"emin", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                   RowBox[{"emax", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "}"}]}], "]"}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"j", "=", 
              RowBox[{"j", "+", "1"}]}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "concls"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "age", " ", "distribution", " ", "of", " ", "parasites", " ", "on", 
        " ", "admission"}], " ", "*)"}], 
      RowBox[{
       RowBox[{"DistributeN", "[", 
        RowBox[{"initN_", ",", "LC_Integer", ",", "mu_", ",", "sigma_"}], 
        "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"distr", ",", "x"}], "}"}], ",", 
         RowBox[{
          RowBox[{"distr", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"PDF", "[", 
               RowBox[{
                RowBox[{"NormalDistribution", "[", 
                 RowBox[{"mu", ",", "sigma"}], "]"}], ",", "x"}], "]"}], "//",
               "N"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "1", ",", "LC"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"initN", "/", 
             RowBox[{"Total", "[", "distr", "]"}]}], ")"}], "*", 
           "distr"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "shift", " ", "the", " ", "list", " ", "of", " ", "number", " ", "to", 
        " ", "the", " ", "right", " ", "with", " ", "a", " ", 
        "multiplication", " ", "pmr"}], "*)"}], 
      RowBox[{
       RowBox[{"Shiftonehour", "[", 
        RowBox[{"ls_List", ",", "PMR_Integer"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "tmp", "}"}], ",", 
         RowBox[{
          RowBox[{"tmp", "=", "ls"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"RotateRight", "[", "tmp", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"ReplacePart", "[", 
            RowBox[{"tmp", ",", 
             RowBox[{"1", "\[Rule]", 
              RowBox[{
               RowBox[{"tmp", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "*", "PMR"}]}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", "tmp"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Eff", "[", 
        RowBox[{
        "c_", ",", "gamma_", ",", "ec50_", ",", "emin_", ",", "emax_"}], 
        "]"}], ":=", 
       RowBox[{"emin", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"emax", "-", "emin"}], ")"}], "*", 
         RowBox[{
          RowBox[{"c", "^", "gamma"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"c", "^", "gamma"}], "+", 
            RowBox[{"ec50", "^", "gamma"}]}], ")"}]}]}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Ki", "[", 
        RowBox[{"T_Real", ",", "concls_List"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "lsk"}], "}"}], ",", 
         RowBox[{
          RowBox[{"lsk", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"1", "/", "T"}], " ", 
                RowBox[{"Log", "[", 
                 RowBox[{"100.", "/", 
                  RowBox[{"(", 
                   RowBox[{"100.", "-", 
                    RowBox[{"concls", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "3"}], "]"}], "]"}]}], ")"}]}], "]"}]}],
                ",", 
               RowBox[{
                RowBox[{"1", "/", "T"}], " ", 
                RowBox[{"Log", "[", 
                 RowBox[{"100.", "/", 
                  RowBox[{"(", 
                   RowBox[{"100.", "-", 
                    RowBox[{"concls", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "4"}], "]"}], "]"}]}], ")"}]}], "]"}]}],
                ",", 
               RowBox[{
                RowBox[{"1", "/", "T"}], " ", 
                RowBox[{"Log", "[", 
                 RowBox[{"100.", "/", 
                  RowBox[{"(", 
                   RowBox[{"100.", "-", 
                    RowBox[{"concls", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "5"}], "]"}], "]"}]}], ")"}]}], 
                 "]"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "concls", "]"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", "lsk"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"decay", " ", "function"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Fdecay", "[", 
        RowBox[{
        "ages_", ",", "lst_", ",", "attime_", ",", "lsk_", ",", "stages_"}], 
        "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"tmp", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"i", "=", "ages"}], ";", "\[IndentingNewLine]", 
          RowBox[{"tmp", "=", 
           RowBox[{"lst", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"stages", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "1"}], ",", 
            RowBox[{"tmp", "=", 
             RowBox[{
              RowBox[{"lst", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "*", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                RowBox[{"lsk", "[", 
                 RowBox[{"[", 
                  RowBox[{"attime", ",", "1"}], "]"}], "]"}]}], "]"}]}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"stages", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "2"}], ",", 
            RowBox[{"tmp", "=", 
             RowBox[{
              RowBox[{"lst", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "*", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                RowBox[{"lsk", "[", 
                 RowBox[{"[", 
                  RowBox[{"attime", ",", "2"}], "]"}], "]"}]}], "]"}]}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"stages", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "3"}], ",", 
            RowBox[{"tmp", "=", 
             RowBox[{
              RowBox[{"lst", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "*", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                RowBox[{"lsk", "[", 
                 RowBox[{"[", 
                  RowBox[{"attime", ",", "3"}], "]"}], "]"}]}], "]"}]}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"WhichRTS", "[", 
        RowBox[{"lst_List", ",", "KZ_List"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "tmp"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tmp", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", "lst", "]"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "\[LessEqual]", 
             RowBox[{"Length", "[", "lst", "]"}]}], ",", 
            RowBox[{"i", "=", 
             RowBox[{"i", "+", "1"}]}], ",", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"IntervalMemberQ", "[", 
                 RowBox[{
                  RowBox[{"Interval", "[", 
                   RowBox[{"KZ", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "i"}], "]"}], 
                "\[Equal]", "True"}], ",", 
               RowBox[{
                RowBox[{"tmp", "=", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"tmp", ",", 
                   RowBox[{"i", "\[Rule]", "1"}]}], "]"}]}], ";"}]}], "]"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"IntervalMemberQ", "[", 
                 RowBox[{
                  RowBox[{"Interval", "[", 
                   RowBox[{"KZ", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "i"}], "]"}], 
                "\[Equal]", "True"}], ",", 
               RowBox[{
                RowBox[{"tmp", "=", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"tmp", ",", 
                   RowBox[{"i", "\[Rule]", "2"}]}], "]"}]}], ";"}]}], "]"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"IntervalMemberQ", "[", 
                 RowBox[{
                  RowBox[{"Interval", "[", 
                   RowBox[{"KZ", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", "i"}], "]"}], 
                "\[Equal]", "True"}], ",", 
               RowBox[{
                RowBox[{"tmp", "=", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"tmp", ",", 
                   RowBox[{"i", "\[Rule]", "3"}]}], "]"}]}], ";"}]}], "]"}], 
             ";"}]}], "]"}], ";", "\[IndentingNewLine]", "tmp"}]}], "]"}]}], 
      ";", "\n", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"sequestration", " ", "function"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"PRingFunc", "[", 
        RowBox[{"i_Integer", ",", "a1_Integer", ",", "a2_Integer"}], "]"}], ":=", 
       RowBox[{"Piecewise", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"i", "<", "a1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"Log", "[", "0.5", "]"}], "*", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"i", "-", "a1"}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{"a2", "-", "a1"}], ")"}]}]}], "]"}], ",", 
            RowBox[{"i", "\[GreaterEqual]", "a1"}]}], "}"}]}], "}"}], "]"}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"LsDot", "[", 
        RowBox[{"ls1_List", ",", "ls2_List"}], "]"}], ":=", 
       RowBox[{"ls1", "*", "ls2"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ParasiteDynamics", "[", 
        RowBox[{
        "initN_", ",", "PMR_Integer", ",", "mu_", ",", "sigma_", ",", 
         "hours_Integer", ",", "KZ_List", ",", "concdat_List", ",", 
         "everyH_Integer", ",", "Ndrug_Integer", ",", "gamma_List", ",", 
         "ec50_List", ",", "emin_List", ",", "emax_List", ",", "T_Real", ",", 
         "runMax_Integer", ",", "data_Integer"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"runs", "=", "True"}], ",", "stages", ",", "concls", ",", 
           "i", ",", "j", ",", "lst", ",", "lsk", ",", 
           RowBox[{"output", "=", 
            RowBox[{"{", "}"}]}], ",", "xm", ",", "ym", ",", "a", ",", "ke", 
           ",", "junk", ",", "onlyring", ",", "tot", ",", "dat1", ",", 
           "dat2"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "template", " ", "of", " ", "the", " ", "drug", " ", "and", " ", 
           "its", " ", "effects"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"xm", "=", 
           RowBox[{"concdat", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ym", "=", 
           RowBox[{"concdat", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"a", "=", 
           RowBox[{"concdat", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ke", "=", 
           RowBox[{"concdat", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"concls", "=", 
           RowBox[{"ConcMod", "[", 
            RowBox[{
            "xm", ",", "ym", ",", "a", ",", "ke", ",", "everyH", ",", "Ndrug",
              ",", "gamma", ",", "ec50", ",", "emin", ",", "emax"}], "]"}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"k_i", " ", 
            RowBox[{"(", "t", ")"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"lsk", "=", 
           RowBox[{"Ki", "[", 
            RowBox[{"T", ",", "concls"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"initial", " ", "parasite", " ", "load"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"lst", "=", 
           RowBox[{"DistributeN", "[", 
            RowBox[{"initN", ",", "hours", ",", "mu", ",", "sigma"}], "]"}]}],
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"stages", "=", 
           RowBox[{"WhichRTS", "[", 
            RowBox[{"lst", ",", "KZ"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"output", ",", "lst"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"runs", "\[Equal]", "True"}], "&&", 
             RowBox[{"i", "<", "runMax"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"i", "=", 
              RowBox[{"i", "+", "1"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Parasites", " ", "are", " ", 
               RowBox[{"growing", ".", "Feed"}], " ", 
               RowBox[{"them", "!"}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"lst", "=", 
              RowBox[{"Shiftonehour", "[", 
               RowBox[{"lst", ",", "PMR"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"a", " ", "time", " ", "to", " ", 
               RowBox[{"kill", "."}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", "=", "1"}], ",", 
               RowBox[{"j", "\[LessEqual]", 
                RowBox[{"Length", "[", "lst", "]"}]}], ",", 
               RowBox[{"j", "=", 
                RowBox[{"j", "+", "1"}]}], ",", 
               RowBox[{
                RowBox[{"lst", "=", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"lst", ",", 
                   RowBox[{"j", "\[Rule]", 
                    RowBox[{"Fdecay", "[", 
                    RowBox[{
                    "j", ",", "lst", ",", "i", ",", "lsk", ",", "stages"}], 
                    "]"}]}]}], "]"}]}], ";"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "adding", " ", "a", " ", "point", " ", "for", " ", "ploting"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"output", ",", "lst"}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"*", "non", " ", "sequestered", " ", "parasites"}], 
           "**)"}], "\[IndentingNewLine]", 
          RowBox[{"junk", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"LsDot", "[", 
              RowBox[{"#", ",", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"PRingFunc", "[", 
                  RowBox[{"i", ",", "11", ",", "14"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "hours"}], "}"}]}], "]"}]}], 
              "]"}], "&"}], "/@", "output"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"onlyring", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"i", "-", "1"}], ",", 
               RowBox[{"Log10", "[", 
                RowBox[{
                 RowBox[{"junk", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "//", "Total"}], "]"}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "junk", "]"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "total", " ", "of", " ", "parasites", " ", "over", " ", "time"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"tot", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"i", "-", "1"}], ",", 
               RowBox[{"Log10", "@", 
                RowBox[{"Total", "[", 
                 RowBox[{"output", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "output", "]"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"data", " ", "set"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"dat1", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "10.923870112051306`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"4", ",", "10.566602457407097`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"8", ",", "9.918784975518461`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"12", ",", "9.300334568002329`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"18", ",", "8.964542466079136`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"24", ",", "8.964542466079136`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"30", ",", "8.186391215695492`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"36", ",", "8.186391215695492`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"42", ",", "7.885361220031511`"}], "}"}]}], "}"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"dat2", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "11.413299764081252`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "11.4345689040342`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"4", ",", "11.440909082065218`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"6", ",", "11.492760389026838`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"8", ",", "11.36735592102602`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"12", ",", "11.103803720955957`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"18", ",", "10.881060749786856`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"24", ",", "10.464851854803731`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"30", ",", "10.510609345364406`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"36", ",", "10.191850582739992`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"42", ",", "10.209579349700425`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"48", ",", "9.28474646957773`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"54", ",", "9.252561786206329`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"60", ",", "8.83758843823551`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"66", ",", "7.439648429563473`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"72", ",", "8.314709692955173`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"78", ",", "7.837588438235509`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"84", ",", "7.740678425227453`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"90", ",", "7.439648429563473`"}], "}"}]}], "}"}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{"data", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", "onlyring", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"data", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"onlyring", ",", "dat1"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"data", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"onlyring", ",", "dat2"}], "}"}]}], 
           "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ParaDist", "[", 
        RowBox[{"initN_", ",", "LC_", ",", "mu_", ",", "sigma_"}], "]"}], ":=",
        "\[IndentingNewLine]", 
       RowBox[{"ListLogPlot", "[", 
        RowBox[{
         RowBox[{"DistributeN", "[", 
          RowBox[{"initN", ",", "LC", ",", "mu", ",", "sigma"}], "]"}], ",", 
         RowBox[{"Filling", "\[Rule]", "Axis"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"350", ",", "150"}], "}"}]}], ",", 
         RowBox[{"Frame", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"True", ",", "True", ",", "False", ",", "False"}], "}"}]}],
          ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
           "\"\<age of parasites (h)\>\"", ",", 
            "\"\<number of parasites\>\""}], "}"}]}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", "Orange", "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"DHAGraph", "[", 
        RowBox[{"xm_", ",", "ym_", ",", "a_", ",", "ke_"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"points", ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"points", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"t", ",", 
               RowBox[{"genpoints", "[", 
                RowBox[{"xm", ",", "ym", ",", "ke", ",", "t"}], "]"}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"t", ",", "0", ",", "20", ",", "0.1"}], "}"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"points", ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
            RowBox[{"Frame", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"True", ",", "True", ",", "False", ",", "False"}], 
              "}"}]}], ",", 
            RowBox[{"FrameLabel", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
              "\"\<time (h)\>\"", ",", "\"\<DHA concentration (ng/ml)\>\""}], 
              "}"}]}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"Red", ",", "Thick"}], "}"}]}], ",", 
            RowBox[{"ImageSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"450", ",", "250"}], "}"}]}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ParaGraph", "[", 
        RowBox[{
        "initN_", ",", "PMR_Integer", ",", "mu_", ",", "sigma_", ",", 
         "hours_Integer", ",", "KZ_List", ",", "concdat_List", ",", 
         "everyH_Integer", ",", "Ndrug_Integer", ",", "gamma_List", ",", 
         "ec50_List", ",", "emin_List", ",", "emax_List", ",", "T_Real", ",", 
         "runMax_Integer", ",", "data_Integer"}], "]"}], ":=", 
       "\[IndentingNewLine]", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"moddat", ",", "detectlimit"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"moddat", "=", 
           RowBox[{"ParasiteDynamics", "[", 
            RowBox[{
            "initN", ",", "PMR", ",", "mu", ",", "sigma", ",", "hours", ",", 
             "KZ", ",", "concdat", ",", "everyH", ",", "Ndrug", ",", "gamma", 
             ",", "ec50", ",", "emin", ",", "emax", ",", "T", ",", "runMax", 
             ",", "data"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"detectlimit", "=", 
           RowBox[{"Which", "[", 
            RowBox[{
             RowBox[{"data", "\[Equal]", "0"}], ",", "8", ",", 
             RowBox[{
              RowBox[{"data", "\[Equal]", "1"}], "||", 
              RowBox[{"data", "\[Equal]", "2"}]}], ",", 
             RowBox[{"Min", "[", 
              RowBox[{"moddat", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "All", ",", "2"}], "]"}], "]"}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"moddat", "\[IndentingNewLine]", ",", 
            RowBox[{"Frame", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"True", ",", "True", ",", "False", ",", "False"}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"\"\<time (h)\>\"", ",", "Medium", ",", "Italic"}], 
                "]"}], ",", 
               RowBox[{"Style", "[", 
                RowBox[{
                "\"\<log10 parasitaemia\>\"", ",", "Medium", ",", "Italic"}], 
                "]"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"True", ",", "True", ",", "False"}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "480"}], ",", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"6", ",", "12.5"}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Blue", ",", "Thick"}], "}"}], ",", 
               RowBox[{"{", "Black", "}"}]}], "}"}]}], ",", 
            RowBox[{"PlotMarkers", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<\[Times]\>\"", ",", "13"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"\"\<\[CircleTimes]\>\"", ",", "13"}], "}"}]}], 
              "}"}]}], ",", 
            RowBox[{"GridLines", "\[Rule]", "Automatic"}], ",", 
            RowBox[{"GridLinesStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"LightGray", ",", "Dashed"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "125"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "13"}], "}"}]}], "}"}]}], ",", 
            RowBox[{"PlotLegends", "\[Rule]", 
             RowBox[{"Placed", "[", 
              RowBox[{
               RowBox[{"LineLegend", "[", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<Circulating\>\"", ",", "\"\<observed data\>\""}], "}"}],
                 "]"}], ",", "Above"}], "]"}]}], ",", " ", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"Pink", ",", "DotDashed", ",", 
               RowBox[{"Line", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0.", ",", "detectlimit"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"120.", ",", "detectlimit"}], "}"}]}], "}"}], 
                "]"}], ",", 
               RowBox[{"Text", "[", 
                RowBox[{"\"\<detection limit\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"100", ",", 
                   RowBox[{"detectlimit", "+", "0.25"}]}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "}"}]}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.521814610463867*^9, 3.521814633495117*^9}, 
   3.521814721448242*^9, {3.521815588508789*^9, 3.521815589836914*^9}, {
   3.521815741586914*^9, 3.521815761633789*^9}, {3.521815913774414*^9, 
   3.521815978133789*^9}, {3.521816008180664*^9, 3.521816016352539*^9}, {
   3.521816060383789*^9, 3.521816060899414*^9}, {3.521816140524414*^9, 
   3.521816237196289*^9}, {3.5218168158847656`*^9, 3.5218168756503906`*^9}, {
   3.5218170158847656`*^9, 3.5218170206191406`*^9}, {3.521850502575093*^9, 
   3.521850506629501*^9}, 3.5218506204837623`*^9, {3.5218507676864147`*^9, 
   3.5218508184888077`*^9}, 3.521851156368944*^9, {3.521851248818699*^9, 
   3.521851255690135*^9}, 3.521851394274506*^9, 3.5218517906271124`*^9, {
   3.5218519341644073`*^9, 3.5218519447307663`*^9}, 3.5218520313967266`*^9, {
   3.5218521190756865`*^9, 3.521852141252572*^9}, {3.521852521568799*^9, 
   3.521852535902359*^9}, {3.5218535908153267`*^9, 3.5218535915181456`*^9}, 
   3.521853655802657*^9, {3.5218538521634035`*^9, 3.5218539061423216`*^9}, {
   3.521853939113819*^9, 3.5218539547171*^9}, {3.5218551393539295`*^9, 
   3.5218551757937613`*^9}, {3.5218559840219355`*^9, 3.52185599298816*^9}, {
   3.5218580506908875`*^9, 3.5218580623863554`*^9}, {3.521858957745637*^9, 
   3.521858958104986*^9}, {3.5218590585354156`*^9, 3.5218590932162485`*^9}, {
   3.5218592290460606`*^9, 3.521859232123516*^9}, {3.5218592874396014`*^9, 
   3.5218592901733813`*^9}, {3.5218593790439167`*^9, 
   3.5218594350601053`*^9}, {3.521859506462782*^9, 3.5218595101805325`*^9}, {
   3.521859714733941*^9, 3.5218597459749413`*^9}, {3.5218599696163044`*^9, 
   3.5218599726799607`*^9}, {3.5218600796265783`*^9, 
   3.5218600838625526`*^9}, {3.5218602082584233`*^9, 
   3.5218602317581224`*^9}, {3.521860266507678*^9, 3.52186027182011*^9}, {
   3.5218603313818474`*^9, 3.5218603529596963`*^9}, {3.5218604016934013`*^9, 
   3.5218604395154743`*^9}, {3.5218604785561013`*^9, 
   3.5218604947566338`*^9}, {3.5218618089121833`*^9, 
   3.5218618118021235`*^9}, {3.521861846309575*^9, 3.521861847434309*^9}, {
   3.5218666959314156`*^9, 3.5218667037122173`*^9}, {3.5218696842010365`*^9, 
   3.5218697139159822`*^9}, {3.5225885927290363`*^9, 
   3.5225886658270035`*^9}, {3.5225887689125414`*^9, 
   3.5225888025381775`*^9}, {3.522588855581661*^9, 3.5225889050967016`*^9}, 
   3.522588987805971*^9, {3.522589794074269*^9, 3.5225898349583673`*^9}, {
   3.522589911020091*^9, 3.5225900463248568`*^9}, {3.522590095907898*^9, 
   3.52259024471294*^9}, {3.522590454039917*^9, 3.522590512270667*^9}, {
   3.5225906305241957`*^9, 3.522590666987865*^9}, {3.5225907594716854`*^9, 
   3.5225907653793616`*^9}, {3.5225909433684807`*^9, 
   3.5225909554136376`*^9}, {3.5225909962575645`*^9, 3.522591299979309*^9}, {
   3.5225913499745607`*^9, 3.5225913565922456`*^9}, {3.52259151362926*^9, 
   3.522591550895005*^9}, {3.522591590435796*^9, 3.5225917661993113`*^9}, {
   3.522591810930206*^9, 3.52259181264524*^9}, {3.5225918771565304`*^9, 
   3.5225920535568085`*^9}, {3.5225921478662386`*^9, 3.522592160103462*^9}, {
   3.52259226979543*^9, 3.5225922708295336`*^9}, 3.522783581814267*^9, 
   3.522783707470009*^9, {3.522783740534132*^9, 3.522783761968639*^9}, {
   3.5227838196343107`*^9, 3.522783824017214*^9}, {3.522783875419714*^9, 
   3.522783918286809*^9}, {3.522783962304118*^9, 3.522783992159997*^9}, {
   3.5227840443010693`*^9, 3.522784066209971*^9}, {3.52278409700589*^9, 
   3.5227841175065527`*^9}, {3.5227841699222193`*^9, 3.5227841924338083`*^9}, 
   3.5231163564672813`*^9, {3.523193370198997*^9, 3.523193382878973*^9}, 
   3.523193435811648*^9, 3.5231935366959743`*^9, {3.5231938435344143`*^9, 
   3.523193863063923*^9}, 3.5231940525337553`*^9, 3.548973997339554*^9, {
   3.5489742170844927`*^9, 3.548974266600162*^9}, {3.5489745229913735`*^9, 
   3.5489746286047277`*^9}, {3.5489747303179445`*^9, 
   3.5489747323147573`*^9}, {3.548975542674983*^9, 3.5489755721439495`*^9}, {
   3.5489756280866256`*^9, 3.5489756363079834`*^9}, {3.5489756741075106`*^9, 
   3.5489757691442633`*^9}, {3.5489758031370993`*^9, 
   3.5489758249617786`*^9}, {3.548976161753628*^9, 3.548976178211734*^9}, {
   3.5489762264200535`*^9, 3.548976229742875*^9}, {3.548976300380128*^9, 
   3.548976309240985*^9}, {3.548976345199215*^9, 3.5489763465252237`*^9}, 
   3.5489764020615797`*^9, {3.5489764997806063`*^9, 3.5489766716157074`*^9}, {
   3.548976742065759*^9, 3.548976801299339*^9}, {3.548977472204879*^9, 
   3.548977475605762*^9}, {3.548977679172772*^9, 3.5489776797187786`*^9}, {
   3.548978288250009*^9, 3.548978314770179*^9}, 3.5489783774981813`*^9, {
   3.5489784191816483`*^9, 3.548978439118576*^9}, {3.5489784869484825`*^9, 
   3.5489785352619925`*^9}, {3.54897860671045*^9, 3.5489788581372623`*^9}, {
   3.5489789005227337`*^9, 3.548978920880864*^9}, {3.548978994950139*^9, 
   3.548979021017906*^9}, {3.548979064994588*^9, 3.5489791800453253`*^9}, {
   3.548979260061144*^9, 3.548979273587471*^9}, {3.548979330750634*^9, 
   3.5489794111285315`*^9}, {3.5489794510678596`*^9, 3.548979458306863*^9}, {
   3.5489795199475994`*^9, 3.5489795652203712`*^9}, {3.5489796180904665`*^9, 
   3.5489796352198153`*^9}, 3.5489796852974205`*^9, {3.5489797173564477`*^9, 
   3.548979853064606*^9}, {3.5489798987731924`*^9, 3.5489799003644123`*^9}, {
   3.5489799355740643`*^9, 3.5489802029770923`*^9}, {3.548980271135002*^9, 
   3.5489802746295366`*^9}, {3.548996405630331*^9, 3.548996408017146*^9}, {
   3.5489964813844166`*^9, 3.548996489964471*^9}, {3.5489965747354145`*^9, 
   3.5489966142504683`*^9}, {3.5489967574125853`*^9, 
   3.5489967834023523`*^9}, {3.54899682672383*^9, 3.548996991133284*^9}, {
   3.5489971012387896`*^9, 3.548997105060814*^9}, {3.5489972307040195`*^9, 
   3.548997386299417*^9}, {3.5489975349839697`*^9, 3.5489975420820155`*^9}, {
   3.5489975823146734`*^9, 3.5489976228125334`*^9}, {3.5489976724054637`*^9, 
   3.548997672951534*^9}, {3.548997986753325*^9, 3.5489979990155535`*^9}, {
   3.5489980652097483`*^9, 3.548998151856591*^9}, {3.548998182792978*^9, 
   3.548998205086521*^9}, {3.5489982464754434`*^9, 3.5489982466470523`*^9}, 
   3.548998279408454*^9, {3.5489983142595243`*^9, 3.5489983151331406`*^9}, {
   3.5489983524646587`*^9, 3.548998391917817*^9}, 3.5489985608846664`*^9, {
   3.548998741503845*^9, 3.5489987760738883`*^9}, {3.5489988244345083`*^9, 
   3.548998835401449*^9}, {3.5866657011556873`*^9, 3.586665730408866*^9}, {
   3.586665805180624*^9, 3.5866659160512457`*^9}, {3.5866659983267*^9, 
   3.586666056360444*^9}, {3.5866660874048424`*^9, 3.5866660877324467`*^9}, {
   3.586666127372555*^9, 3.5866661395095105`*^9}, {3.5866661812244453`*^9, 
   3.586666240645607*^9}, {3.586666293857889*^9, 3.5866663102536993`*^9}, {
   3.5866663421717086`*^9, 3.58666637736576*^9}, {3.586666601011227*^9, 
   3.58666675957166*^9}, {3.5866668043130336`*^9, 3.5866668457159643`*^9}, {
   3.5866668939517827`*^9, 3.586666903779909*^9}, {3.5866669727795935`*^9, 
   3.586667040453261*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`ctrl$$ = 1, $CellContext`dataset$$ = 
    0, $CellContext`ec50R$$ = 20.5, $CellContext`ec50S$$ = 
    20.5, $CellContext`ec50T$$ = 20.5, $CellContext`emaxR$$ = 
    99.99, $CellContext`emaxS$$ = 99.99, $CellContext`emaxT$$ = 
    99.99, $CellContext`everyH$$ = 24, $CellContext`initN$$ = 
    2.8*^11, $CellContext`ke$$ = 0.5, $CellContext`KZRB$$ = 
    6, $CellContext`KZRE$$ = 26, $CellContext`KZSE$$ = 
    44, $CellContext`KZTE$$ = 38, $CellContext`Ndrug$$ = 
    7, $CellContext`PMR$$ = 7, $CellContext`T$$ = 5., $CellContext`xm$$ = 
    2, $CellContext`ym$$ = 1000, $CellContext`\[Gamma]R$$ = 
    6.5, $CellContext`\[Gamma]S$$ = 6.5, $CellContext`\[Gamma]T$$ = 
    6.5, $CellContext`\[Mu]$$ = 10, $CellContext`\[Sigma]$$ = 4, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{
      Hold[
       Style["Mahidol-Oxford Tropical Medicine Research Unit", Bold]], 
      Manipulate`Dump`ThisIsNotAControl}, {{
       Hold[$CellContext`ctrl$$], 1, ""}, {
      1 -> "parasite distribution", 2 -> "dose regimen", 3 -> 
       "DHA concentration", 4 -> "kill zones", 5 -> "killing effect", 6 -> 
       "Data set"}}, {{
       Hold[$CellContext`initN$$], 2.8*^11, ""}, 1.*^11, 1000000000000, 
      5.*^10}, {{
       Hold[$CellContext`PMR$$], 7, ""}, 6, 32, 1}, {{
       Hold[$CellContext`\[Mu]$$], 10, ""}, 1, 48, 1}, {{
       Hold[$CellContext`\[Sigma]$$], 4, ""}, 1, 50, 1}, {{
       Hold[$CellContext`Ndrug$$], 7, ""}, 1, 24, 1}, {{
       Hold[$CellContext`everyH$$], 24, ""}, 1, 48, 1}, {{
       Hold[$CellContext`xm$$], 2, ""}, 1, 20}, {{
       Hold[$CellContext`ym$$], 1000, ""}, 0.5, 2000.}, {{
       Hold[$CellContext`ke$$], 0.5, ""}, 0.001, 10}, {{
       Hold[$CellContext`KZRB$$], 6, ""}, 1, 96, 1}, {{
       Hold[$CellContext`KZRE$$], 26, ""}, 
      Dynamic[$CellContext`KZRB$$], 60, 1}, {{
       Hold[$CellContext`KZTE$$], 38, ""}, 
      Dynamic[$CellContext`KZRE$$ + 1], 90, 1}, {{
       Hold[$CellContext`KZSE$$], 44, ""}, 
      Dynamic[$CellContext`KZTE$$ + 1], 100, 1}, {{
       Hold[$CellContext`\[Gamma]R$$], 6.5}, 0.5, 10, 0.001}, {{
       Hold[$CellContext`\[Gamma]T$$], 6.5}, 0.5, 10, 0.001}, {{
       Hold[$CellContext`\[Gamma]S$$], 6.5}, 0.5, 10, 0.001}, {{
       Hold[$CellContext`ec50R$$], 20.5, ""}, 0.001, 100, 0.001}, {{
       Hold[$CellContext`ec50T$$], 20.5, ""}, 0.001, 100, 0.001}, {{
       Hold[$CellContext`ec50S$$], 20.5, ""}, 0.001, 100, 0.001}, {{
       Hold[$CellContext`emaxR$$], 99.99, ""}, 50, 99.999, 0.001}, {{
       Hold[$CellContext`emaxT$$], 99.99, ""}, 50, 99.999, 0.001}, {{
       Hold[$CellContext`emaxS$$], 99.99, ""}, 50, 99.999, 0.001}, {{
       Hold[$CellContext`T$$], 5., ""}, 1., 10., 0.001}, {{
       Hold[$CellContext`dataset$$], 0, ""}, {
      0 -> "No", 1 -> "Wang Pha (M21)", 2 -> "Pailin (P33)"}}, {
      Hold[
       PaneSelector[{1 -> Column[{
            Style["Parasite distribution on admission", Bold], 
            "initial number of parasites", 
            Manipulate`Place[1], "parasite multiplication rate (/48 hours)", 
            Manipulate`Place[2], "mean age of parasite (hours)", 
            Manipulate`Place[3], 
            "standard deviation of parasite ages (hours)", 
            Manipulate`Place[4]}], 2 -> Column[{
            Style["Dose regimen", Bold], "number of doses", 
            Manipulate`Place[5], "dosing interval (hours)", 
            Manipulate`Place[6]}], 3 -> Column[{
            Style["DHA concentration profile (for each dose)", Bold], 
            "time at max concentration (hours)", 
            Manipulate`Place[7], "max concentration (ng/ml)", 
            Manipulate`Place[8], "elimination rate (/hours)", 
            Manipulate`Place[9]}], 4 -> Column[{
            Style["Kill zones (sensitive ages) ", Bold], 
            "ring: begin kill zone (hours)", 
            Manipulate`Place[10], "ring: end kill zone (hours)", 
            Manipulate`Place[11], "trophozoite: end kill zone (hours)", 
            Manipulate`Place[12], "schizont: end kill zone (hours)", 
            Manipulate`Place[13]}], 5 -> Column[{
            Style["Killing effect parameters", Bold], 
            Manipulate`Place[14], 
            Manipulate`Place[15], 
            Manipulate`Place[16], "EC50 ring (ng/ml)", 
            Manipulate`Place[17], "EC50 trophozoites (ng/ml)", 
            Manipulate`Place[18], "EC50 schizont (ng/ml)", 
            Manipulate`Place[19], "ring: max efficacy (%)", 
            Manipulate`Place[20], "trophozoite: max efficacy (%)", 
            Manipulate`Place[21], "schizont: max efficacy (%)", 
            Manipulate`Place[22], "1/alpha", 
            Manipulate`Place[23]}], 6 -> Column[{
            Style["Data set", Bold], "Show observed data", 
            Manipulate`Place[24]}]}, 
        Dynamic[$CellContext`ctrl$$]]], Manipulate`Dump`ThisIsNotAControl}}, 
    Typeset`size$$ = Automatic, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = False, $CellContext`ctrl$660782$$ = 
    False, $CellContext`initN$660783$$ = 0, $CellContext`PMR$660784$$ = 
    0, $CellContext`\[Mu]$660785$$ = 0, $CellContext`\[Sigma]$660786$$ = 
    0, $CellContext`Ndrug$660787$$ = 0, $CellContext`everyH$660788$$ = 
    0, $CellContext`xm$660789$$ = 0, $CellContext`ym$660790$$ = 
    0, $CellContext`ke$660791$$ = 0, $CellContext`KZRB$660792$$ = 
    0, $CellContext`dataset$660793$$ = False}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     2, StandardForm, 
      "Variables" :> {$CellContext`ctrl$$ = 1, $CellContext`dataset$$ = 
        0, $CellContext`ec50R$$ = 20.5, $CellContext`ec50S$$ = 
        20.5, $CellContext`ec50T$$ = 20.5, $CellContext`emaxR$$ = 
        99.99, $CellContext`emaxS$$ = 99.99, $CellContext`emaxT$$ = 
        99.99, $CellContext`everyH$$ = 24, $CellContext`initN$$ = 
        2.8*^11, $CellContext`ke$$ = 0.5, $CellContext`KZRB$$ = 
        6, $CellContext`KZRE$$ = 26, $CellContext`KZSE$$ = 
        44, $CellContext`KZTE$$ = 38, $CellContext`Ndrug$$ = 
        7, $CellContext`PMR$$ = 7, $CellContext`T$$ = 5., $CellContext`xm$$ = 
        2, $CellContext`ym$$ = 1000, $CellContext`\[Gamma]R$$ = 
        6.5, $CellContext`\[Gamma]S$$ = 6.5, $CellContext`\[Gamma]T$$ = 
        6.5, $CellContext`\[Mu]$$ = 10, $CellContext`\[Sigma]$$ = 4}, 
      "ControllerVariables" :> {
        Hold[$CellContext`ctrl$$, $CellContext`ctrl$660782$$, False], 
        Hold[$CellContext`initN$$, $CellContext`initN$660783$$, 0], 
        Hold[$CellContext`PMR$$, $CellContext`PMR$660784$$, 0], 
        Hold[$CellContext`\[Mu]$$, $CellContext`\[Mu]$660785$$, 0], 
        Hold[$CellContext`\[Sigma]$$, $CellContext`\[Sigma]$660786$$, 0], 
        Hold[$CellContext`Ndrug$$, $CellContext`Ndrug$660787$$, 0], 
        Hold[$CellContext`everyH$$, $CellContext`everyH$660788$$, 0], 
        Hold[$CellContext`xm$$, $CellContext`xm$660789$$, 0], 
        Hold[$CellContext`ym$$, $CellContext`ym$660790$$, 0], 
        Hold[$CellContext`ke$$, $CellContext`ke$660791$$, 0], 
        Hold[$CellContext`KZRB$$, $CellContext`KZRB$660792$$, 0], 
        Hold[$CellContext`dataset$$, $CellContext`dataset$660793$$, False]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Column[{
         $CellContext`ParaGraph[$CellContext`initN$$, $CellContext`PMR$$, \
$CellContext`\[Mu]$$, $CellContext`\[Sigma]$$, 
          48, {{$CellContext`KZRB$$, $CellContext`KZRE$$}, \
{$CellContext`KZRE$$ + 1, $CellContext`KZTE$$}, {$CellContext`KZTE$$ + 
            1, $CellContext`KZSE$$}}, {$CellContext`xm$$, $CellContext`ym$$, \
$CellContext`a, $CellContext`ke$$}, $CellContext`everyH$$, \
$CellContext`Ndrug$$, {$CellContext`\[Gamma]R$$, $CellContext`\[Gamma]T$$, \
$CellContext`\[Gamma]S$$}, {$CellContext`ec50R$$, $CellContext`ec50T$$, \
$CellContext`ec50S$$}, {0., 0., 
          0.}, {$CellContext`emaxR$$, $CellContext`emaxT$$, \
$CellContext`emaxS$$}, $CellContext`T$$, 120, $CellContext`dataset$$]}], 
      "Specifications" :> {
        Style["Mahidol-Oxford Tropical Medicine Research Unit", Bold], 
        Delimiter, {{$CellContext`ctrl$$, 1, ""}, {
         1 -> "parasite distribution", 2 -> "dose regimen", 3 -> 
          "DHA concentration", 4 -> "kill zones", 5 -> "killing effect", 6 -> 
          "Data set"}, ControlPlacement -> 
         Top}, {{$CellContext`initN$$, 2.8*^11, ""}, 1.*^11, 1000000000000, 
         5.*^10, Appearance -> "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         1}, {{$CellContext`PMR$$, 7, ""}, 6, 32, 1, Appearance -> "Labeled", 
         ImageSize -> Tiny, ControlPlacement -> 
         2}, {{$CellContext`\[Mu]$$, 10, ""}, 1, 48, 1, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         3}, {{$CellContext`\[Sigma]$$, 4, ""}, 1, 50, 1, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         4}, {{$CellContext`Ndrug$$, 7, ""}, 1, 24, 1, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         5}, {{$CellContext`everyH$$, 24, ""}, 1, 48, 1, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         6}, {{$CellContext`xm$$, 2, ""}, 1, 20, Appearance -> "Labeled", 
         ImageSize -> Tiny, ControlPlacement -> 
         7}, {{$CellContext`ym$$, 1000, ""}, 0.5, 2000., Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         8}, {{$CellContext`ke$$, 0.5, ""}, 0.001, 10, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         9}, {{$CellContext`KZRB$$, 6, ""}, 1, 96, 1, Appearance -> "Labeled",
          ImageSize -> Tiny, ControlPlacement -> 
         10}, {{$CellContext`KZRE$$, 26, ""}, 
         Dynamic[$CellContext`KZRB$$], 60, 1, Appearance -> "Labeled", 
         ImageSize -> Tiny, ControlPlacement -> 
         11}, {{$CellContext`KZTE$$, 38, ""}, 
         Dynamic[$CellContext`KZRE$$ + 1], 90, 1, Appearance -> "Labeled", 
         ImageSize -> Tiny, ControlPlacement -> 
         12}, {{$CellContext`KZSE$$, 44, ""}, 
         Dynamic[$CellContext`KZTE$$ + 1], 100, 1, Appearance -> "Labeled", 
         ImageSize -> Tiny, ControlPlacement -> 
         13}, {{$CellContext`\[Gamma]R$$, 6.5}, 0.5, 10, 0.001, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         14}, {{$CellContext`\[Gamma]T$$, 6.5}, 0.5, 10, 0.001, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         15}, {{$CellContext`\[Gamma]S$$, 6.5}, 0.5, 10, 0.001, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         16}, {{$CellContext`ec50R$$, 20.5, ""}, 0.001, 100, 0.001, 
         Appearance -> "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         17}, {{$CellContext`ec50T$$, 20.5, ""}, 0.001, 100, 0.001, 
         Appearance -> "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         18}, {{$CellContext`ec50S$$, 20.5, ""}, 0.001, 100, 0.001, 
         Appearance -> "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         19}, {{$CellContext`emaxR$$, 99.99, ""}, 50, 99.999, 0.001, 
         Appearance -> "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         20}, {{$CellContext`emaxT$$, 99.99, ""}, 50, 99.999, 0.001, 
         Appearance -> "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         21}, {{$CellContext`emaxS$$, 99.99, ""}, 50, 99.999, 0.001, 
         Appearance -> "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         22}, {{$CellContext`T$$, 5., ""}, 1., 10., 0.001, Appearance -> 
         "Labeled", ImageSize -> Tiny, ControlPlacement -> 
         23}, {{$CellContext`dataset$$, 0, ""}, {
         0 -> "No", 1 -> "Wang Pha (M21)", 2 -> "Pailin (P33)"}, ControlType -> 
         RadioButton, ControlPlacement -> 24}, 
        PaneSelector[{1 -> Column[{
             Style["Parasite distribution on admission", Bold], 
             "initial number of parasites", 
             Manipulate`Place[1], "parasite multiplication rate (/48 hours)", 
             Manipulate`Place[2], "mean age of parasite (hours)", 
             Manipulate`Place[3], 
             "standard deviation of parasite ages (hours)", 
             Manipulate`Place[4]}], 2 -> Column[{
             Style["Dose regimen", Bold], "number of doses", 
             Manipulate`Place[5], "dosing interval (hours)", 
             Manipulate`Place[6]}], 3 -> Column[{
             Style["DHA concentration profile (for each dose)", Bold], 
             "time at max concentration (hours)", 
             Manipulate`Place[7], "max concentration (ng/ml)", 
             Manipulate`Place[8], "elimination rate (/hours)", 
             Manipulate`Place[9]}], 4 -> Column[{
             Style["Kill zones (sensitive ages) ", Bold], 
             "ring: begin kill zone (hours)", 
             Manipulate`Place[10], "ring: end kill zone (hours)", 
             Manipulate`Place[11], "trophozoite: end kill zone (hours)", 
             Manipulate`Place[12], "schizont: end kill zone (hours)", 
             Manipulate`Place[13]}], 5 -> Column[{
             Style["Killing effect parameters", Bold], 
             Manipulate`Place[14], 
             Manipulate`Place[15], 
             Manipulate`Place[16], "EC50 ring (ng/ml)", 
             Manipulate`Place[17], "EC50 trophozoites (ng/ml)", 
             Manipulate`Place[18], "EC50 schizont (ng/ml)", 
             Manipulate`Place[19], "ring: max efficacy (%)", 
             Manipulate`Place[20], "trophozoite: max efficacy (%)", 
             Manipulate`Place[21], "schizont: max efficacy (%)", 
             Manipulate`Place[22], "1/alpha", 
             Manipulate`Place[23]}], 6 -> Column[{
             Style["Data set", Bold], "Show observed data", 
             Manipulate`Place[24]}]}, 
         Dynamic[$CellContext`ctrl$$]]}, 
      "Options" :> {
       ControlPlacement -> Left, SynchronousInitialization -> False, 
        ContinuousAction -> False, AutorunSequencing -> {1, 2}}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{789., {218., 223.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    Initialization:>({$CellContext`genpoints[
          Pattern[$CellContext`xm, 
           Blank[]], 
          Pattern[$CellContext`ym, 
           Blank[]], 
          Pattern[$CellContext`ke, 
           Blank[]], 
          Pattern[$CellContext`x, 
           Blank[]]] := 
        Piecewise[{{$CellContext`ym - ($CellContext`ym/$CellContext`xm) \
($CellContext`xm - $CellContext`x), $CellContext`x <= $CellContext`xm}, \
{$CellContext`ym 
            Exp[(-$CellContext`ke) ($CellContext`x - $CellContext`xm)], \
$CellContext`x > $CellContext`xm}}]; $CellContext`ConcMod[
          Pattern[$CellContext`xm, 
           Blank[]], 
          Pattern[$CellContext`ym, 
           Blank[]], 
          Pattern[$CellContext`a, 
           Blank[]], 
          Pattern[$CellContext`ke, 
           Blank[]], 
          Pattern[$CellContext`everyH, 
           Blank[Integer]], 
          Pattern[$CellContext`Ndrug, 
           Blank[Integer]], 
          Pattern[$CellContext`gamma, 
           Blank[List]], 
          Pattern[$CellContext`ec50, 
           Blank[List]], 
          Pattern[$CellContext`emin, 
           Blank[List]], 
          Pattern[$CellContext`emax, 
           Blank[List]]] := 
        Module[{$CellContext`i, $CellContext`j = 0, $CellContext`nd = 
           1, $CellContext`dat, $CellContext`maxpoint, $CellContext`part1, \
$CellContext`part2, $CellContext`fitke, $CellContext`modka, \
$CellContext`modke, $CellContext`fn, $CellContext`x, $CellContext`endtime, \
$CellContext`t, $CellContext`conc = 
           0, $CellContext`concls = {}, $CellContext`TIMEMAX = 1000}, 
          For[$CellContext`i = 
            0, $CellContext`i < $CellContext`Ndrug $CellContext`everyH, \
$CellContext`i = $CellContext`i + 1, 
            If[$CellContext`j != $CellContext`everyH, $CellContext`conc = 
               ReplaceAll[
                 $CellContext`genpoints[$CellContext`xm, $CellContext`ym, \
$CellContext`ke, $CellContext`x], $CellContext`x -> $CellContext`j]; 
              AppendTo[$CellContext`concls, {$CellContext`i, \
$CellContext`conc, 
                 $CellContext`Eff[$CellContext`conc, 
                  Part[$CellContext`gamma, 1], 
                  Part[$CellContext`ec50, 1], 
                  Part[$CellContext`emin, 1], 
                  Part[$CellContext`emax, 1]], 
                 $CellContext`Eff[$CellContext`conc, 
                  Part[$CellContext`gamma, 2], 
                  Part[$CellContext`ec50, 2], 
                  Part[$CellContext`emin, 2], 
                  Part[$CellContext`emax, 2]], 
                 $CellContext`Eff[$CellContext`conc, 
                  Part[$CellContext`gamma, 3], 
                  Part[$CellContext`ec50, 3], 
                  Part[$CellContext`emin, 3], 
                  Part[$CellContext`emax, 3]]}]; Null]; If[
              
              And[$CellContext`j == $CellContext`everyH, $CellContext`nd < \
$CellContext`Ndrug], $CellContext`nd = $CellContext`nd + 1; $CellContext`conc = 
               ReplaceAll[$CellContext`conc + \
$CellContext`genpoints[$CellContext`xm, $CellContext`ym, $CellContext`ke, \
$CellContext`x], $CellContext`x -> $CellContext`j]; 
              AppendTo[$CellContext`concls, {$CellContext`i, \
$CellContext`conc, 
                 $CellContext`Eff[$CellContext`conc, 
                  Part[$CellContext`gamma, 1], 
                  Part[$CellContext`ec50, 1], 
                  Part[$CellContext`emin, 1], 
                  Part[$CellContext`emax, 1]], 
                 $CellContext`Eff[$CellContext`conc, 
                  Part[$CellContext`gamma, 2], 
                  Part[$CellContext`ec50, 2], 
                  Part[$CellContext`emin, 2], 
                  Part[$CellContext`emax, 2]], 
                 $CellContext`Eff[$CellContext`conc, 
                  Part[$CellContext`gamma, 3], 
                  Part[$CellContext`ec50, 3], 
                  Part[$CellContext`emin, 3], 
                  Part[$CellContext`emax, 3]]}]; $CellContext`j = 0; 
              Null]; $CellContext`j = $CellContext`j + 1; Null]; 
          For[$CellContext`i = $CellContext`Ndrug $CellContext`everyH; \
$CellContext`j = $CellContext`everyH, $CellContext`i <= $CellContext`TIMEMAX, \
$CellContext`i = $CellContext`i + 1, $CellContext`conc = ReplaceAll[
               $CellContext`genpoints[$CellContext`xm, $CellContext`ym, \
$CellContext`ke, $CellContext`x], $CellContext`x -> $CellContext`j]; 
            AppendTo[$CellContext`concls, {$CellContext`i, $CellContext`conc, 
               $CellContext`Eff[$CellContext`conc, 
                Part[$CellContext`gamma, 1], 
                Part[$CellContext`ec50, 1], 
                Part[$CellContext`emin, 1], 
                Part[$CellContext`emax, 1]], 
               $CellContext`Eff[$CellContext`conc, 
                Part[$CellContext`gamma, 2], 
                Part[$CellContext`ec50, 2], 
                Part[$CellContext`emin, 2], 
                Part[$CellContext`emax, 2]], 
               $CellContext`Eff[$CellContext`conc, 
                Part[$CellContext`gamma, 3], 
                Part[$CellContext`ec50, 3], 
                Part[$CellContext`emin, 3], 
                
                Part[$CellContext`emax, 
                 3]]}]; $CellContext`j = $CellContext`j + 1; 
            Null]; $CellContext`concls]; $CellContext`DistributeN[
          Pattern[$CellContext`initN, 
           Blank[]], 
          Pattern[$CellContext`LC, 
           Blank[Integer]], 
          Pattern[$CellContext`mu, 
           Blank[]], 
          Pattern[$CellContext`sigma, 
           Blank[]]] := 
        Module[{$CellContext`distr, $CellContext`x}, $CellContext`distr = 
           Table[
             N[
              PDF[
               
               NormalDistribution[$CellContext`mu, $CellContext`sigma], \
$CellContext`x]], {$CellContext`x, 1, $CellContext`LC}]; ($CellContext`initN/
            Total[$CellContext`distr]) $CellContext`distr]; \
$CellContext`Shiftonehour[
          Pattern[$CellContext`ls, 
           Blank[List]], 
          Pattern[$CellContext`PMR, 
           Blank[Integer]]] := 
        Module[{$CellContext`tmp}, $CellContext`tmp = $CellContext`ls; \
$CellContext`tmp = RotateRight[$CellContext`tmp]; $CellContext`tmp = 
           ReplacePart[$CellContext`tmp, 1 -> 
             Part[$CellContext`tmp, 
                1] $CellContext`PMR]; $CellContext`tmp]; $CellContext`Eff[
          Pattern[$CellContext`c, 
           Blank[]], 
          Pattern[$CellContext`gamma, 
           Blank[]], 
          Pattern[$CellContext`ec50, 
           Blank[]], 
          Pattern[$CellContext`emin, 
           Blank[]], 
          Pattern[$CellContext`emax, 
           
           Blank[]]] := $CellContext`emin + ($CellContext`emax - \
$CellContext`emin) \
($CellContext`c^$CellContext`gamma/($CellContext`c^$CellContext`gamma + \
$CellContext`ec50^$CellContext`gamma)); $CellContext`Ki[
          Pattern[$CellContext`T, 
           Blank[Real]], 
          Pattern[$CellContext`concls, 
           Blank[List]]] := 
        Module[{$CellContext`i, $CellContext`lsk}, $CellContext`lsk = 
           Table[{(1/$CellContext`T) 
              Log[100./(100. - 
                Part[$CellContext`concls, $CellContext`i, 3])], (
               1/$CellContext`T) 
              Log[100./(100. - 
                Part[$CellContext`concls, $CellContext`i, 4])], (
               1/$CellContext`T) 
              Log[100./(100. - 
                Part[$CellContext`concls, $CellContext`i, 
                 5])]}, {$CellContext`i, 1, 
              
              Length[$CellContext`concls]}]; $CellContext`lsk]; \
$CellContext`Fdecay[
          Pattern[$CellContext`ages, 
           Blank[]], 
          Pattern[$CellContext`lst, 
           Blank[]], 
          Pattern[$CellContext`attime, 
           Blank[]], 
          Pattern[$CellContext`lsk, 
           Blank[]], 
          Pattern[$CellContext`stages, 
           Blank[]]] := 
        Module[{$CellContext`tmp, $CellContext`i}, $CellContext`i = \
$CellContext`ages; $CellContext`tmp = Part[$CellContext`lst, $CellContext`i]; 
          If[Part[$CellContext`stages, $CellContext`i] == 1, $CellContext`tmp = 
            Part[$CellContext`lst, $CellContext`i] 
             Exp[-Part[$CellContext`lsk, $CellContext`attime, 1]]]; 
          If[Part[$CellContext`stages, $CellContext`i] == 2, $CellContext`tmp = 
            Part[$CellContext`lst, $CellContext`i] 
             Exp[-Part[$CellContext`lsk, $CellContext`attime, 2]]]; 
          If[Part[$CellContext`stages, $CellContext`i] == 3, $CellContext`tmp = 
            Part[$CellContext`lst, $CellContext`i] 
             Exp[-Part[$CellContext`lsk, $CellContext`attime, 
                 3]]]; $CellContext`tmp]; $CellContext`WhichRTS[
          Pattern[$CellContext`lst, 
           Blank[List]], 
          Pattern[$CellContext`KZ, 
           Blank[List]]] := 
        Module[{$CellContext`i, $CellContext`tmp}, $CellContext`tmp = 
           Table[0, {
              Length[$CellContext`lst]}]; 
          For[$CellContext`i = 1, $CellContext`i <= 
            Length[$CellContext`lst], $CellContext`i = $CellContext`i + 1, 
            If[IntervalMemberQ[
                Interval[
                 Part[$CellContext`KZ, 1]], $CellContext`i] == 
              True, $CellContext`tmp = 
               ReplacePart[$CellContext`tmp, $CellContext`i -> 1]; Null]; 
            If[IntervalMemberQ[
                Interval[
                 Part[$CellContext`KZ, 2]], $CellContext`i] == 
              True, $CellContext`tmp = 
               ReplacePart[$CellContext`tmp, $CellContext`i -> 2]; Null]; 
            If[IntervalMemberQ[
                Interval[
                 Part[$CellContext`KZ, 3]], $CellContext`i] == 
              True, $CellContext`tmp = 
               ReplacePart[$CellContext`tmp, $CellContext`i -> 3]; Null]; 
            Null]; $CellContext`tmp]; $CellContext`PRingFunc[
          Pattern[$CellContext`i, 
           Blank[Integer]], 
          Pattern[$CellContext`a1, 
           Blank[Integer]], 
          Pattern[$CellContext`a2, 
           Blank[Integer]]] := 
        Piecewise[{{1, $CellContext`i < $CellContext`a1}, {
            Exp[
            Log[0.5] (($CellContext`i - $CellContext`a1)/($CellContext`a2 - \
$CellContext`a1))], $CellContext`i >= $CellContext`a1}}]; $CellContext`LsDot[
          Pattern[$CellContext`ls1, 
           Blank[List]], 
          Pattern[$CellContext`ls2, 
           Blank[
           List]]] := $CellContext`ls1 $CellContext`ls2; \
$CellContext`ParasiteDynamics[
          Pattern[$CellContext`initN, 
           Blank[]], 
          Pattern[$CellContext`PMR, 
           Blank[Integer]], 
          Pattern[$CellContext`mu, 
           Blank[]], 
          Pattern[$CellContext`sigma, 
           Blank[]], 
          Pattern[$CellContext`hours, 
           Blank[Integer]], 
          Pattern[$CellContext`KZ, 
           Blank[List]], 
          Pattern[$CellContext`concdat, 
           Blank[List]], 
          Pattern[$CellContext`everyH, 
           Blank[Integer]], 
          Pattern[$CellContext`Ndrug, 
           Blank[Integer]], 
          Pattern[$CellContext`gamma, 
           Blank[List]], 
          Pattern[$CellContext`ec50, 
           Blank[List]], 
          Pattern[$CellContext`emin, 
           Blank[List]], 
          Pattern[$CellContext`emax, 
           Blank[List]], 
          Pattern[$CellContext`T, 
           Blank[Real]], 
          Pattern[$CellContext`runMax, 
           Blank[Integer]], 
          Pattern[$CellContext`data, 
           Blank[Integer]]] := 
        Module[{$CellContext`runs = 
           True, $CellContext`stages, $CellContext`concls, $CellContext`i, \
$CellContext`j, $CellContext`lst, $CellContext`lsk, $CellContext`output = {}, \
$CellContext`xm, $CellContext`ym, $CellContext`a, $CellContext`ke, \
$CellContext`junk, $CellContext`onlyring, $CellContext`tot, \
$CellContext`dat1, $CellContext`dat2}, $CellContext`xm = 
           Part[$CellContext`concdat, 1]; $CellContext`ym = 
           Part[$CellContext`concdat, 2]; $CellContext`a = 
           Part[$CellContext`concdat, 3]; $CellContext`ke = 
           Part[$CellContext`concdat, 
             4]; $CellContext`concls = $CellContext`ConcMod[$CellContext`xm, \
$CellContext`ym, $CellContext`a, $CellContext`ke, $CellContext`everyH, \
$CellContext`Ndrug, $CellContext`gamma, $CellContext`ec50, $CellContext`emin, \
$CellContext`emax]; $CellContext`lsk = $CellContext`Ki[$CellContext`T, \
$CellContext`concls]; $CellContext`lst = \
$CellContext`DistributeN[$CellContext`initN, $CellContext`hours, \
$CellContext`mu, $CellContext`sigma]; $CellContext`stages = \
$CellContext`WhichRTS[$CellContext`lst, $CellContext`KZ]; 
          AppendTo[$CellContext`output, $CellContext`lst]; $CellContext`i = 0; 
          While[
            
            And[$CellContext`runs == 
             True, $CellContext`i < $CellContext`runMax], $CellContext`i = \
$CellContext`i + 
              1; $CellContext`lst = \
$CellContext`Shiftonehour[$CellContext`lst, $CellContext`PMR]; 
            For[$CellContext`j = 1, $CellContext`j <= 
              Length[$CellContext`lst], $CellContext`j = $CellContext`j + 
               1, $CellContext`lst = 
               ReplacePart[$CellContext`lst, $CellContext`j -> \
$CellContext`Fdecay[$CellContext`j, $CellContext`lst, $CellContext`i, \
$CellContext`lsk, $CellContext`stages]]; Null]; 
            AppendTo[$CellContext`output, $CellContext`lst]; 
            Null]; $CellContext`junk = Map[$CellContext`LsDot[#, 
              Table[
               $CellContext`PRingFunc[$CellContext`i, 11, 
                14], {$CellContext`i, 
                1, $CellContext`hours}]]& , $CellContext`output]; \
$CellContext`onlyring = Table[{$CellContext`i - 1, 
              Log10[
               Total[
                Part[$CellContext`junk, $CellContext`i]]]}, {$CellContext`i, 
              1, 
              Length[$CellContext`junk]}]; $CellContext`tot = 
           Table[{$CellContext`i - 1, 
              Log10[
               Total[
                Part[$CellContext`output, $CellContext`i]]]}, {$CellContext`i,
               1, 
              Length[$CellContext`output]}]; $CellContext`dat1 = {{
             0, 10.923870112051306`}, {4, 10.566602457407097`}, {
             8, 9.918784975518461}, {12, 9.300334568002329}, {
             18, 8.964542466079136}, {24, 8.964542466079136}, {
             30, 8.186391215695492}, {36, 8.186391215695492}, {
             42, 7.885361220031511}}; $CellContext`dat2 = {{
             0, 11.413299764081252`}, {2, 11.4345689040342}, {
             4, 11.440909082065218`}, {6, 11.492760389026838`}, {
             8, 11.36735592102602}, {12, 11.103803720955957`}, {
             18, 10.881060749786856`}, {24, 10.464851854803731`}, {
             30, 10.510609345364406`}, {36, 10.191850582739992`}, {
             42, 10.209579349700425`}, {48, 9.28474646957773}, {
             54, 9.252561786206329}, {60, 8.83758843823551}, {
             66, 7.439648429563473}, {72, 8.314709692955173}, {
             78, 7.837588438235509}, {84, 7.740678425227453}, {
             90, 7.439648429563473}}; 
          Which[$CellContext`data == 
            0, {$CellContext`onlyring}, $CellContext`data == 
            1, {$CellContext`onlyring, $CellContext`dat1}, $CellContext`data == 
            2, {$CellContext`onlyring, $CellContext`dat2}]]; \
$CellContext`ParaDist[
          Pattern[$CellContext`initN, 
           Blank[]], 
          Pattern[$CellContext`LC, 
           Blank[]], 
          Pattern[$CellContext`mu, 
           Blank[]], 
          Pattern[$CellContext`sigma, 
           Blank[]]] := ListLogPlot[
          $CellContext`DistributeN[$CellContext`initN, $CellContext`LC, \
$CellContext`mu, $CellContext`sigma], Filling -> Axis, 
          ImageSize -> {350, 150}, Frame -> {True, True, False, False}, 
          FrameLabel -> {"age of parasites (h)", "number of parasites"}, 
          PlotStyle -> {Orange}]; $CellContext`DHAGraph[
          Pattern[$CellContext`xm, 
           Blank[]], 
          Pattern[$CellContext`ym, 
           Blank[]], 
          Pattern[$CellContext`a, 
           Blank[]], 
          Pattern[$CellContext`ke, 
           Blank[]]] := 
        Module[{$CellContext`points, $CellContext`t}, $CellContext`points = 
           Table[{$CellContext`t, 
              $CellContext`genpoints[$CellContext`xm, $CellContext`ym, \
$CellContext`ke, $CellContext`t]}, {$CellContext`t, 0, 20, 0.1}]; 
          ListPlot[$CellContext`points, Joined -> True, PlotRange -> All, 
            Frame -> {True, True, False, False}, 
            FrameLabel -> {"time (h)", "DHA concentration (ng/ml)"}, 
            PlotStyle -> {Red, Thick}, 
            ImageSize -> {450, 250}]]; $CellContext`ParaGraph[
          Pattern[$CellContext`initN, 
           Blank[]], 
          Pattern[$CellContext`PMR, 
           Blank[Integer]], 
          Pattern[$CellContext`mu, 
           Blank[]], 
          Pattern[$CellContext`sigma, 
           Blank[]], 
          Pattern[$CellContext`hours, 
           Blank[Integer]], 
          Pattern[$CellContext`KZ, 
           Blank[List]], 
          Pattern[$CellContext`concdat, 
           Blank[List]], 
          Pattern[$CellContext`everyH, 
           Blank[Integer]], 
          Pattern[$CellContext`Ndrug, 
           Blank[Integer]], 
          Pattern[$CellContext`gamma, 
           Blank[List]], 
          Pattern[$CellContext`ec50, 
           Blank[List]], 
          Pattern[$CellContext`emin, 
           Blank[List]], 
          Pattern[$CellContext`emax, 
           Blank[List]], 
          Pattern[$CellContext`T, 
           Blank[Real]], 
          Pattern[$CellContext`runMax, 
           Blank[Integer]], 
          Pattern[$CellContext`data, 
           Blank[Integer]]] := 
        Module[{$CellContext`moddat, $CellContext`detectlimit}, \
$CellContext`moddat = $CellContext`ParasiteDynamics[$CellContext`initN, \
$CellContext`PMR, $CellContext`mu, $CellContext`sigma, $CellContext`hours, \
$CellContext`KZ, $CellContext`concdat, $CellContext`everyH, \
$CellContext`Ndrug, $CellContext`gamma, $CellContext`ec50, $CellContext`emin, \
$CellContext`emax, $CellContext`T, $CellContext`runMax, $CellContext`data]; \
$CellContext`detectlimit = Which[$CellContext`data == 0, 8, 
             Or[$CellContext`data == 1, $CellContext`data == 2], 
             Min[
              Part[$CellContext`moddat, 2, All, 2]]]; 
          ListPlot[$CellContext`moddat, Frame -> {True, True, False, False}, 
            FrameLabel -> {
              Style["time (h)", Medium, Italic], 
              Style["log10 parasitaemia", Medium, Italic]}, 
            Joined -> {True, True, False}, ImageSize -> 480, 
            PlotRange -> {6, 12.5}, PlotStyle -> {{Blue, Thick}, {Black}}, 
            PlotMarkers -> {{"\[Times]", 13}, {"\[CircleTimes]", 13}}, 
            GridLines -> Automatic, GridLinesStyle -> 
            Directive[LightGray, Dashed], PlotRange -> {{0, 125}, {0, 13}}, 
            PlotLegends -> Placed[
              LineLegend[{"Circulating", "observed data"}], Above], 
            Epilog -> {Pink, DotDashed, 
              
              Line[{{0., $CellContext`detectlimit}, {
                120., $CellContext`detectlimit}}], 
              Text[
              "detection limit", {100, $CellContext`detectlimit + 0.25}]}]]}; 
     Typeset`initDone$$ = True),
    SynchronousInitialization->False,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.5489796620682755`*^9, 3.548979686576661*^9}, 
   3.5489802103403864`*^9, 3.548980275861984*^9, 3.5489964093431544`*^9, 
   3.5489964941764984`*^9, 3.548996620568508*^9, 3.5489967843851585`*^9, {
   3.548996833119871*^9, 3.5489968507011833`*^9}, 3.5489969428977747`*^9, {
   3.548996976047987*^9, 3.5489971058876195`*^9}, 3.548997388109029*^9, 
   3.5489975426748195`*^9, 3.548997637195825*^9, {3.548997674121684*^9, 
   3.5489977349538817`*^9}, 3.5489981588301487`*^9, {3.548998375631104*^9, 
   3.5489983997803683`*^9}, 3.548998569995242*^9, {3.5489987493195457`*^9, 
   3.5489987775247073`*^9}, 3.5489988373046737`*^9, 3.549003728499663*^9, 
   3.5866658072710505`*^9, 3.5866658535568447`*^9, 3.586665918048071*^9, {
   3.586666038529416*^9, 3.58666605681285*^9}, 3.5866660880912514`*^9, 
   3.586666140632725*^9, {3.5866662200221424`*^9, 3.5866662410668125`*^9}, {
   3.586666297508336*^9, 3.5866663117357187`*^9}, {3.5866663787541776`*^9, 
   3.5866665543042283`*^9}, {3.58666668937076*^9, 3.5866667607104745`*^9}, 
   3.5866668113487234`*^9, 3.5866668461683702`*^9, 3.5866669047783213`*^9, {
   3.586666996148693*^9, 3.5866670409836674`*^9}}]
}, Open  ]]
},
WindowSize->{1172, 853},
WindowMargins->{{Automatic, 202}, {Automatic, 44}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 63037, 1358, 4392, "Input"],
Cell[63619, 1382, 35364, 690, 490, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
